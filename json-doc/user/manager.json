{
    "doc": {
        "description": "A class for managing users",
        "tags": {
            "copyright": "BBN Solutions",
            "since": "Apr 4, 2011, 23:23:55 +0000",
            "category": "Authentication",
            "license": "http:\/\/www.opensource.org\/licenses\/mit-license.php MIT",
            "version": "0.2r89"
        }
    },
    "name": "bbn\\user\\manager",
    "namespace": true,
    "traits": [],
    "interfaces": [],
    "fileName": "\/home\/thomas\/domains\/apstapp.thomas.lan\/_appui\/vendor\/bbn\/bbn\/src\/bbn\/user\/manager.php",
    "startLine": 20,
    "endLine": 872,
    "contentConstructor": {
        "file": "bbn\\user\\manager",
        "returns": null
    },
    "methods": {
        "get_list_fields": {
            "name": "get_list_fields",
            "summary": "",
            "description": "",
            "description_parts": [],
            "file": "bbn\\user\\manager",
            "static": false,
            "visibility": "public",
            "final": false,
            "code": "function()\n  {\n    return $this->list_fields;\n  }",
            "startLine": 63,
            "endLine": 66,
            "isDeprecated": false,
            "isGenerator": false,
            "isInternal": false,
            "isUserDefined": true,
            "isVariadic": false,
            "returnsReference": false,
            "numberOfParameters": 0,
            "numberOfRequiredParameters": 0,
            "returns": null,
            "parent": false,
            "arguments": []
        },
        "get_mailer": {
            "name": "get_mailer",
            "summary": "",
            "description": "",
            "description_parts": [],
            "file": "bbn\\user\\manager",
            "static": false,
            "visibility": "public",
            "final": false,
            "code": "function()\n  {\n      $this->mailer = $this->usrcls->get_mailer();\n    }\n    return $this->mailer;\n  }",
            "startLine": 68,
            "endLine": 73,
            "isDeprecated": false,
            "isGenerator": false,
            "isInternal": false,
            "isUserDefined": true,
            "isVariadic": false,
            "returnsReference": false,
            "numberOfParameters": 0,
            "numberOfRequiredParameters": 0,
            "returns": null,
            "parent": false,
            "arguments": []
        },
        "find_sessions": {
            "name": "find_sessions",
            "summary": "",
            "description": "",
            "description_parts": [],
            "file": "bbn\\user\\manager",
            "static": false,
            "visibility": "public",
            "final": false,
            "code": "function($id_user = NULL, $minutes = 5)\n  {\n    $cfg = [\n      'table' => $this->class_cfg['tables']['sessions'],\n      'fields' => [],\n      'where' => [\n        [\n          'field' => $this->class_cfg['arch']['sessions']['last_activity'],\n          'operator' => '<',\n          'value' => 'DATE_SUB(NOW(), INTERVAL '.$this->db->csn($this->class_cfg['sess_length'], true).' MINUTE)'\n        ]\n      ]\n    ];\n    if ( !\\is_null($id_user) ){\n      $cfg['where'][] = [\n        'field' => $this->class_cfg['arch']['sessions']['id_user'],\n        'value' => $id_user\n      ];\n    }\n    return $this->db->rselect_all($cfg);\n  }",
            "startLine": 75,
            "endLine": 95,
            "isDeprecated": false,
            "isGenerator": false,
            "isInternal": false,
            "isUserDefined": true,
            "isVariadic": false,
            "returnsReference": false,
            "numberOfParameters": 2,
            "numberOfRequiredParameters": 0,
            "returns": [
                "array"
            ],
            "parent": false,
            "arguments": [
                {
                    "name": "id_user",
                    "position": 0,
                    "type": "string",
                    "required": false,
                    "has_default": true,
                    "default": null,
                    "default_name": ""
                },
                {
                    "name": "minutes",
                    "position": 1,
                    "type": "int",
                    "required": false,
                    "has_default": true,
                    "default": 5,
                    "default_name": ""
                }
            ]
        },
        "destroy_sessions": {
            "name": "destroy_sessions",
            "summary": "",
            "description": "",
            "description_parts": [],
            "file": "bbn\\user\\manager",
            "static": false,
            "visibility": "public",
            "final": false,
            "code": "function($id_user, $minutes = 5)\n  {\n    $sessions = $this->find_sessions($id_user, $minutes);    \n    \/\/$num = count($sessions);\n    foreach ( $sessions as $s ){\n      $this->db->delete($this->class_cfg['tables']['sessions'], [$this->class_cfg['arch']['sessions']['id'] => $s['id']]);\n    }    \n    return true;\n  }",
            "startLine": 97,
            "endLine": 105,
            "isDeprecated": false,
            "isGenerator": false,
            "isInternal": false,
            "isUserDefined": true,
            "isVariadic": false,
            "returnsReference": false,
            "numberOfParameters": 2,
            "numberOfRequiredParameters": 1,
            "returns": [
                "bool"
            ],
            "parent": false,
            "arguments": [
                {
                    "name": "id_user",
                    "position": 0,
                    "type": "string",
                    "required": true,
                    "has_default": false,
                    "default": "",
                    "default_name": ""
                },
                {
                    "name": "minutes",
                    "position": 1,
                    "type": "int",
                    "required": false,
                    "has_default": true,
                    "default": 5,
                    "default_name": ""
                }
            ]
        },
        "__construct": {
            "name": "__construct",
            "summary": "",
            "description": "",
            "description_parts": [],
            "file": "bbn\\user\\manager",
            "static": false,
            "visibility": "public",
            "final": false,
            "code": "function(bbn\\user $obj)\n  {\n    if ( \\is_object($obj) && method_exists($obj, 'get_class_cfg') ){\n      $this->usrcls = $obj;\n      $this->class_cfg = $this->usrcls->get_class_cfg();\n      if ( !$this->list_fields ){\n        $this->set_default_list_fields();\n      }\n      $this->db =& $this->usrcls->db;\n    }\n  }",
            "startLine": 112,
            "endLine": 122,
            "isDeprecated": false,
            "isGenerator": false,
            "isInternal": false,
            "isUserDefined": true,
            "isVariadic": false,
            "returnsReference": false,
            "numberOfParameters": 1,
            "numberOfRequiredParameters": 1,
            "returns": null,
            "parent": false,
            "arguments": [
                {
                    "name": "obj",
                    "position": 0,
                    "type": "bbn\\user",
                    "required": true,
                    "has_default": false,
                    "default": "",
                    "default_name": "",
                    "description": "A user's connection object (\\connection or subclass)"
                }
            ]
        },
        "is_online": {
            "name": "is_online",
            "summary": "",
            "description": "",
            "description_parts": [],
            "file": "bbn\\user\\manager",
            "static": false,
            "visibility": "public",
            "final": false,
            "code": "function($id_user, $delay = 180)\n  {\n    $a =& $this->class_cfg['arch'];\n    $t =& $this->class_cfg['tables'];\n    if (\n      ($max = $this->db->select_one($t['sessions'], 'MAX('.$a['sessions']['last_activity'].')', ['id_user' => $id_user]))\n      &&(strtotime($max) > (time() - $delay))\n    ) {\n      return true;\n    }\n    return false;\n  }",
            "startLine": 124,
            "endLine": 135,
            "isDeprecated": false,
            "isGenerator": false,
            "isInternal": false,
            "isUserDefined": true,
            "isVariadic": false,
            "returnsReference": false,
            "numberOfParameters": 2,
            "numberOfRequiredParameters": 1,
            "returns": [
                "bool"
            ],
            "parent": false,
            "arguments": [
                {
                    "name": "id_user",
                    "position": 0,
                    "type": "string",
                    "required": true,
                    "has_default": false,
                    "default": "",
                    "default_name": ""
                },
                {
                    "name": "delay",
                    "position": 1,
                    "type": "int",
                    "required": false,
                    "has_default": true,
                    "default": 180,
                    "default_name": ""
                }
            ]
        },
        "groups": {
            "name": "groups",
            "summary": "Returns all the users' groups - with or without admin",
            "description": "",
            "description_parts": [],
            "file": "bbn\\user\\manager",
            "static": false,
            "visibility": "public",
            "final": false,
            "code": "function()\n  {\n    $a =& $this->class_cfg['arch'];\n    $t =& $this->class_cfg['tables'];\n    $id = $this->db->cfn($a['groups']['id'], $t['groups']);\n    $users_id = $this->db->cfn($a['users']['id'], $t['users'], 1);\n    return $this->db->rselect_all([\n      'tables' => [$t['groups']],\n      'fields' => array_merge($a['groups'], ['num' => \"COUNT($users_id)\"]),\n      'join' => [\n        [\n          'table' => $t['users'],\n          'type' => 'left',\n          'on' => [\n            [\n              'field' => 'id_group',\n              'exp' => $id\n            ]\n          ]\n        ]\n      ],\n      'group_by' => [$id]\n    ]);\n  }",
            "startLine": 142,
            "endLine": 165,
            "isDeprecated": false,
            "isGenerator": false,
            "isInternal": false,
            "isUserDefined": true,
            "isVariadic": false,
            "returnsReference": false,
            "numberOfParameters": 0,
            "numberOfRequiredParameters": 0,
            "returns": [
                "array"
            ],
            "parent": false,
            "arguments": []
        },
        "text_value_groups": {
            "name": "text_value_groups",
            "summary": "",
            "description": "",
            "description_parts": [],
            "file": "bbn\\user\\manager",
            "static": false,
            "visibility": "public",
            "final": false,
            "code": "function()\n  {\n    return $this->db->rselect_all(\n      $this->class_cfg['tables']['groups'], [\n        'value' => $this->class_cfg['arch']['groups']['id'],\n        'text' => $this->class_cfg['arch']['groups']['group'],\n      ]);\n  }",
            "startLine": 167,
            "endLine": 174,
            "isDeprecated": false,
            "isGenerator": false,
            "isInternal": false,
            "isUserDefined": true,
            "isVariadic": false,
            "returnsReference": false,
            "numberOfParameters": 0,
            "numberOfRequiredParameters": 0,
            "returns": null,
            "parent": false,
            "arguments": []
        },
        "get_email": {
            "name": "get_email",
            "summary": "",
            "description": "",
            "description_parts": [],
            "file": "bbn\\user\\manager",
            "static": false,
            "visibility": "public",
            "final": false,
            "code": "function($id)\n  {\n    if ( bbn\\str::is_uid($id) ){\n      $email = $this->db->select_one($this->class_cfg['tables']['users'], $this->class_cfg['arch']['users']['email'], [$this->class_cfg['arch']['users']['id'] => $id]);\n      if ( $email && bbn\\str::is_email($email) ){\n        return $email;\n      }\n    }\n    return null;\n  }",
            "startLine": 176,
            "endLine": 185,
            "isDeprecated": false,
            "isGenerator": false,
            "isInternal": false,
            "isUserDefined": true,
            "isVariadic": false,
            "returnsReference": false,
            "numberOfParameters": 1,
            "numberOfRequiredParameters": 1,
            "returns": [
                "string",
                null
            ],
            "parent": false,
            "arguments": [
                {
                    "name": "id",
                    "position": 0,
                    "type": "string",
                    "required": true,
                    "has_default": false,
                    "default": "",
                    "default_name": ""
                }
            ]
        },
        "get_list": {
            "name": "get_list",
            "summary": "",
            "description": "",
            "description_parts": [],
            "file": "bbn\\user\\manager",
            "static": false,
            "visibility": "public",
            "final": false,
            "code": "function($group_id = NULL)\n  {\n    $db =& $this->db;\n    $arch =& $this->class_cfg['arch'];\n    $s =& $arch['sessions'];\n    $tables =& $this->class_cfg['tables'];\n\n    if ( !empty($arch['users']['username']) ){\n      $sort = $arch['users']['username'];\n    }\n    else if ( !empty($arch['users']['login']) ){\n      $sort = $arch['users']['login'];\n    }\n    else{\n      $sort = $arch['users']['email'];\n    }\n\n    $sql = \"SELECT \";\n    $done = [];\n    foreach ( $arch['users'] as $n => $f ){\n      if ( !\\in_array($f, $done) ){\n        $sql .= $db->cfn($f, $tables['users'], 1).', ';\n        array_push($done, $f);\n      }\n    }\n    $gr = !empty($group_id) && \\bbn\\str::is_uid($group_id) ?\n      \"AND \" . $db->cfn($arch['groups']['id'], $tables['groups'], 1) . \" = UNHEX('$group_id')\" : '';\n    $sql .= \"\n      MAX({$db->cfn($s['last_activity'], $tables['sessions'], 1)}) AS {$db->csn($s['last_activity'], 1)},\n      COUNT({$db->cfn($s['sess_id'], $tables['sessions'])}) AS {$db->csn($s['sess_id'], 1)}\n      FROM {$db->escape($tables['users'])}\n        JOIN {$db->tsn($tables['groups'], 1)}\n          ON {$db->cfn($arch['users']['id_group'], $tables['users'], 1)} = {$db->cfn($arch['groups']['id'], $tables['groups'], 1)}\n          $gr\n        LEFT JOIN {$db->tsn($tables['sessions'])}\n          ON {$db->cfn($s['id_user'], $tables['sessions'], 1)} = {$db->cfn($arch['users']['id'], $tables['users'], 1)}\n      WHERE {$db->cfn($arch['users']['active'], $tables['users'], 1)} = 1\n      GROUP BY {$db->cfn($arch['users']['id'], $tables['users'], 1)}\n      ORDER BY {$db->cfn($sort, $tables['users'], 1)}\";\n    return $db->get_rows($sql);\n  }",
            "startLine": 188,
            "endLine": 228,
            "isDeprecated": false,
            "isGenerator": false,
            "isInternal": false,
            "isUserDefined": true,
            "isVariadic": false,
            "returnsReference": false,
            "numberOfParameters": 1,
            "numberOfRequiredParameters": 0,
            "returns": [
                "array"
            ],
            "parent": false,
            "arguments": [
                {
                    "name": "group_id",
                    "position": 0,
                    "type": "string",
                    "required": false,
                    "has_default": true,
                    "default": null,
                    "default_name": ""
                }
            ]
        },
        "get_user": {
            "name": "get_user",
            "summary": "",
            "description": "",
            "description_parts": [],
            "file": "bbn\\user\\manager",
            "static": false,
            "visibility": "public",
            "final": false,
            "code": "function($id)\n  {\n    $u = $this->class_cfg['arch']['users'];\n    if ( bbn\\str::is_uid($id) ){\n      $where = [$u['id'] => $id];\n    }\n    else{\n      $where = [$u['login'] => $id];\n    }\n    if ( $user = $this->db->rselect(\n      $this->class_cfg['tables']['users'],\n      array_values($u),\n      $where)\n    ){\n      if ( $session = $this->db->rselect(\n        $this->class_cfg['tables']['sessions'],\n        array_values($this->class_cfg['arch']['sessions']),\n        [$this->class_cfg['arch']['sessions']['id_user'] => $user[$u['id']]],\n        [$this->class_cfg['arch']['sessions']['last_activity'] => 'DESC']\n      ) ){\n        $session['id_session'] = $session['id'];\n      }\n      else{\n        $session = array_fill_keys(\n          array_values($this->class_cfg['arch']['sessions']),\n          '');\n        $session['id_session'] = false;\n      }\n      return array_merge($session, $user);\n    }\n    return null;\n  }",
            "startLine": 230,
            "endLine": 261,
            "isDeprecated": false,
            "isGenerator": false,
            "isInternal": false,
            "isUserDefined": true,
            "isVariadic": false,
            "returnsReference": false,
            "numberOfParameters": 1,
            "numberOfRequiredParameters": 1,
            "returns": [
                "array",
                null
            ],
            "parent": false,
            "arguments": [
                {
                    "name": "id",
                    "position": 0,
                    "type": "string",
                    "required": true,
                    "has_default": false,
                    "default": "",
                    "default_name": ""
                }
            ]
        },
        "get_group": {
            "name": "get_group",
            "summary": "",
            "description": "",
            "description_parts": [],
            "file": "bbn\\user\\manager",
            "static": false,
            "visibility": "public",
            "final": false,
            "code": "function($id)\n  {\n    $g = $this->class_cfg['arch']['groups'];\n    if ( $group = $this->db->rselect($this->class_cfg['tables']['groups'], [], [\n      $g['id'] => $id\n    ]) ){\n      $group[$g['cfg']] = $group[$g['cfg']] ? json_decode($group[$g['cfg']], 1) : [];\n      return $group;\n    }\n    return null;\n  }",
            "startLine": 263,
            "endLine": 273,
            "isDeprecated": false,
            "isGenerator": false,
            "isInternal": false,
            "isUserDefined": true,
            "isVariadic": false,
            "returnsReference": false,
            "numberOfParameters": 1,
            "numberOfRequiredParameters": 1,
            "returns": [
                "array",
                null
            ],
            "parent": false,
            "arguments": [
                {
                    "name": "id",
                    "position": 0,
                    "type": "string",
                    "required": true,
                    "has_default": false,
                    "default": "",
                    "default_name": ""
                }
            ]
        },
        "get_users": {
            "name": "get_users",
            "summary": "",
            "description": "",
            "description_parts": [],
            "file": "bbn\\user\\manager",
            "static": false,
            "visibility": "public",
            "final": false,
            "code": "function($group_id = NULL)\n  {\n    return $this->db->get_col_array(\"\n      SELECT \".$this->class_cfg['arch']['users']['id'].\"\n      FROM \".$this->class_cfg['tables']['users'].\"\n      WHERE {$this->db->escape($this->class_cfg['tables']['users'].'.'.$this->class_cfg['arch']['users']['active'])} = 1\n      AND \".$this->class_cfg['arch']['users']['id_group'].\" \".( $group_id ? \"= \".(int)$group_id : \"!= 1\" )\n    );\n  }",
            "startLine": 275,
            "endLine": 283,
            "isDeprecated": false,
            "isGenerator": false,
            "isInternal": false,
            "isUserDefined": true,
            "isVariadic": false,
            "returnsReference": false,
            "numberOfParameters": 1,
            "numberOfRequiredParameters": 0,
            "returns": [
                "array"
            ],
            "parent": false,
            "arguments": [
                {
                    "name": "group_id",
                    "position": 0,
                    "type": null,
                    "required": false,
                    "has_default": true,
                    "default": null,
                    "default_name": ""
                }
            ]
        },
        "full_list": {
            "name": "full_list",
            "summary": "",
            "description": "",
            "description_parts": [],
            "file": "bbn\\user\\manager",
            "static": false,
            "visibility": "public",
            "final": false,
            "code": "function()\n  {\n    $r = [];\n    $u = $this->class_cfg['arch']['users'];\n    foreach ( $this->db->rselect_all('bbn_users') as $a ){\n      $r[] = [\n        'value' => $a[$u['id']],\n        'text' => $this->get_name($a, false),\n        'id_group' => $a[$u['id_group']],\n        'active' => $a[$u['active']] ? true : false\n      ];\n    }\n    return $r;\n  }",
            "startLine": 285,
            "endLine": 298,
            "isDeprecated": false,
            "isGenerator": false,
            "isInternal": false,
            "isUserDefined": true,
            "isVariadic": false,
            "returnsReference": false,
            "numberOfParameters": 0,
            "numberOfRequiredParameters": 0,
            "returns": [
                "array"
            ],
            "parent": false,
            "arguments": []
        },
        "get_user_id": {
            "name": "get_user_id",
            "summary": "",
            "description": "",
            "description_parts": [],
            "file": "bbn\\user\\manager",
            "static": false,
            "visibility": "public",
            "final": false,
            "code": "function($login)\n  {\n    return $this->db->select_one(\n      $this->class_cfg['tables']['users'], \n      $this->class_cfg['arch']['users']['id'],\n      [\n        $this->class_cfg['arch']['users']['login'] => $login\n      ]);\n  }",
            "startLine": 300,
            "endLine": 308,
            "isDeprecated": false,
            "isGenerator": false,
            "isInternal": false,
            "isUserDefined": true,
            "isVariadic": false,
            "returnsReference": false,
            "numberOfParameters": 1,
            "numberOfRequiredParameters": 1,
            "returns": [
                "string",
                null
            ],
            "parent": false,
            "arguments": [
                {
                    "name": "login",
                    "position": 0,
                    "type": "string",
                    "required": true,
                    "has_default": false,
                    "default": "",
                    "default_name": ""
                }
            ]
        },
        "get_admin_group": {
            "name": "get_admin_group",
            "summary": "",
            "description": "",
            "description_parts": [],
            "file": "bbn\\user\\manager",
            "static": false,
            "visibility": "public",
            "final": false,
            "code": "function()\n  {\n    if (!self::$admin_group) {\n      if ($res = $this->db->select_one(\n        $this->class_cfg['tables']['groups'], \n        $this->class_cfg['arch']['groups']['id'],\n        [\n          $this->class_cfg['arch']['groups']['code'] => 'admin'\n        ]\n        )\n      ) {\n        self::set_admin_group($res);\n      }\n    }\n    return self::$admin_group;\n  }",
            "startLine": 310,
            "endLine": 325,
            "isDeprecated": false,
            "isGenerator": false,
            "isInternal": false,
            "isUserDefined": true,
            "isVariadic": false,
            "returnsReference": false,
            "numberOfParameters": 0,
            "numberOfRequiredParameters": 0,
            "returns": [
                "string",
                null
            ],
            "parent": false,
            "arguments": []
        },
        "get_dev_group": {
            "name": "get_dev_group",
            "summary": "",
            "description": "",
            "description_parts": [],
            "file": "bbn\\user\\manager",
            "static": false,
            "visibility": "public",
            "final": false,
            "code": "function()\n  {\n    if (!self::$dev_group) {\n      if ($res = $this->db->select_one(\n        $this->class_cfg['tables']['groups'], \n        $this->class_cfg['arch']['groups']['id'],\n        [\n          $this->class_cfg['arch']['groups']['code'] => 'dev'\n        ]\n        )\n      ) {\n        self::set_dev_group($res);\n      }\n    }\n    return self::$dev_group;\n  }",
            "startLine": 327,
            "endLine": 342,
            "isDeprecated": false,
            "isGenerator": false,
            "isInternal": false,
            "isUserDefined": true,
            "isVariadic": false,
            "returnsReference": false,
            "numberOfParameters": 0,
            "numberOfRequiredParameters": 0,
            "returns": [
                "string",
                null
            ],
            "parent": false,
            "arguments": []
        },
        "get_name": {
            "name": "get_name",
            "summary": "",
            "description": "",
            "description_parts": [],
            "file": "bbn\\user\\manager",
            "static": false,
            "visibility": "public",
            "final": false,
            "code": "function($user, $full = true)\n  {\n      $user = $this->get_user($user);\n    }\n    if ( \\is_array($user) ){\n      $idx = 'email';\n      if ( !empty($this->class_cfg['arch']['users']['username']) ){\n        $idx = 'username';\n      }\n      else if ( !empty($this->class_cfg['arch']['users']['login']) ){\n        $idx = 'login';\n      }\n      return $user[$this->class_cfg['arch']['users'][$idx]];\n    }\n    return '';\n  }",
            "startLine": 344,
            "endLine": 359,
            "isDeprecated": false,
            "isGenerator": false,
            "isInternal": false,
            "isUserDefined": true,
            "isVariadic": false,
            "returnsReference": false,
            "numberOfParameters": 2,
            "numberOfRequiredParameters": 1,
            "returns": null,
            "parent": false,
            "arguments": [
                {
                    "name": "user",
                    "position": 0,
                    "type": null,
                    "required": true,
                    "has_default": false,
                    "default": "",
                    "default_name": ""
                },
                {
                    "name": "full",
                    "position": 1,
                    "type": null,
                    "required": false,
                    "has_default": true,
                    "default": true,
                    "default_name": ""
                }
            ]
        },
        "get_group_type": {
            "name": "get_group_type",
            "summary": "",
            "description": "",
            "description_parts": [],
            "file": "bbn\\user\\manager",
            "static": false,
            "visibility": "public",
            "final": false,
            "code": "function($id_group)\n  {\n    $g =& $this->class_cfg['arch']['groups'];\n    return $this->db->select_one($this->class_cfg['tables']['groups'], $g['type'], [$g['id'] => $id_group]);\n  }",
            "startLine": 361,
            "endLine": 365,
            "isDeprecated": false,
            "isGenerator": false,
            "isInternal": false,
            "isUserDefined": true,
            "isVariadic": false,
            "returnsReference": false,
            "numberOfParameters": 1,
            "numberOfRequiredParameters": 1,
            "returns": [
                "string",
                null
            ],
            "parent": false,
            "arguments": [
                {
                    "name": "id_group",
                    "position": 0,
                    "type": "string",
                    "required": true,
                    "has_default": false,
                    "default": "",
                    "default_name": ""
                }
            ]
        },
        "add": {
            "name": "add",
            "summary": "Creates a new user and returns its configuration (with the new ID)",
            "description": "",
            "description_parts": [],
            "file": "bbn\\user\\manager",
            "static": false,
            "visibility": "public",
            "final": false,
            "code": "function(array $cfg)\n  {\n    $u =& $this->class_cfg['arch']['users'];\n    $fields = array_unique(array_values($u));\n    $cfg[$u['active']] = 1;\n    $cfg[$u['cfg']] = '{}';\n    foreach ( $cfg as $k => $v ){\n      if ( !\\in_array($k, $fields) ){\n        unset($cfg[$k]);\n      }\n    }\n    if ( isset($cfg['id']) ){\n      unset($cfg['id']);\n    }\n    if (!empty($cfg[$u['id_group']])) {\n      $group = $this->get_group_type($cfg[$u['id_group']]);\n      switch ($group) {\n        case 'real':\n          if (\n            bbn\\str::is_email($cfg[$u['email']]) &&\n                  $this->db->insert($this->class_cfg['tables']['users'], $cfg)\n          ){\n            $cfg[$u['id']] = $this->db->last_id();\n            \/\/ Envoi d'un lien\n            $this->make_hotlink($cfg[$this->class_cfg['arch']['users']['id']], 'creation');\n            return $cfg;\n          }\n          break;\n        case 'api':\n          $cfg[$u['email']] = null;\n          $cfg[$u['login']] = null;\n          if ($this->db->insert($this->class_cfg['tables']['users'], $cfg)) {\n            $cfg[$u['id']] = $this->db->last_id();\n            return $cfg;\n          }\n          break;\n      }\n    }\n\t\treturn null;\n  }",
            "startLine": 373,
            "endLine": 412,
            "isDeprecated": false,
            "isGenerator": false,
            "isInternal": false,
            "isUserDefined": true,
            "isVariadic": false,
            "returnsReference": false,
            "numberOfParameters": 1,
            "numberOfRequiredParameters": 1,
            "returns": [
                "array",
                null
            ],
            "parent": false,
            "arguments": [
                {
                    "name": "cfg",
                    "position": 0,
                    "type": "array",
                    "required": true,
                    "has_default": false,
                    "default": "",
                    "default_name": ""
                }
            ]
        },
        "edit": {
            "name": "edit",
            "summary": "Creates a new user and returns its configuration (with the new ID)",
            "description": "",
            "description_parts": [],
            "file": "bbn\\user\\manager",
            "static": false,
            "visibility": "public",
            "final": false,
            "code": "function(array $cfg, $id_user = NULL)\n  {\n\t  $u =& $this->class_cfg['arch']['users'];\n    $fields = array_unique(array_values($this->class_cfg['arch']['users']));\n    $cfg[$u['active']] = 1;\n    foreach ( $cfg as $k => $v ){\n      if ( !\\in_array($k, $fields) ){\n        unset($cfg[$k]);\n      }\n    }\n    if ( !$id_user && isset($cfg[$u['id']]) ){\n      $id_user = $cfg[$u['id']];\n    }\n    if ( $id_user && (\n            !isset($cfg[$this->class_cfg['arch']['users']['email']]) ||\n            bbn\\str::is_email($cfg[$this->class_cfg['arch']['users']['email']])\n          )\n    ){\n      if ( $this->db->update($this->class_cfg['tables']['users'], $cfg, [\n        $u['id'] => $id_user\n      ]) ){\n        $cfg['id'] = $id_user;\n        return $cfg;\n      }\n    }\n\t\treturn null;\n  }",
            "startLine": 420,
            "endLine": 446,
            "isDeprecated": false,
            "isGenerator": false,
            "isInternal": false,
            "isUserDefined": true,
            "isVariadic": false,
            "returnsReference": false,
            "numberOfParameters": 2,
            "numberOfRequiredParameters": 1,
            "returns": [
                "array",
                null
            ],
            "parent": false,
            "arguments": [
                {
                    "name": "cfg",
                    "position": 0,
                    "type": "array",
                    "required": true,
                    "has_default": false,
                    "default": "",
                    "default_name": ""
                },
                {
                    "name": "id_user",
                    "position": 1,
                    "type": "string",
                    "required": false,
                    "has_default": true,
                    "default": null,
                    "default_name": ""
                }
            ]
        },
        "copy": {
            "name": "copy",
            "summary": "",
            "description": "",
            "description_parts": [],
            "file": "bbn\\user\\manager",
            "static": false,
            "visibility": "public",
            "final": false,
            "code": "function($type, $id, array $data)\n  {\n    $pref = preferences::get_preferences();\n    $cfg = $pref->get_class_cfg();\n    switch ($type) {\n      case 'user':\n        if ($src = $this->get_user($id)) {\n          $data = x::merge_arrays($src, $data);\n          unset($data[$this->class_cfg['arch']['users']['id']]);\n          $col = $cfg['arch']['user_options']['id_user'];\n          $id_new = $this->add($data);\n        }\n        break;\n      case 'group':\n        if ($src = $this->get_group($id)) {\n          $data = x::merge_arrays($src, $data);\n          unset($data[$this->class_cfg['arch']['groups']['id']]);\n          $col = $cfg['arch']['user_options']['id_group'];\n          $id_new = $this->group_insert($data);\n        }\n        break;\n    }\n    if (!empty($id_new)) {\n      if ($options = $this->get_options($type, $id)) {\n        $ids = [];\n        foreach ($options as $o) {\n          $old_id = $o['id'];\n          unset($o['id']);\n          $o[$col] = $id_new;\n          if ($this->db->insert_ignore($cfg['table'], $o)) {\n            $ids[$old_id] = $this->db->last_id();\n          }\n        }\n        $bids = [];\n        foreach ($ids as $oid => $nid) {\n          $bits = $this->db->rselect_all($cfg['tables']['user_options_bits'], [], [\n            $cfg['arch']['user_options_bits']['id_user_option'] => $oid,\n            $cfg['arch']['user_options_bits']['id_parent'] => null\n          ]);\n          foreach ($bits as $bit) {\n            $old_id = $bit[$cfg['arch']['user_options_bits']['id']];\n            unset($bit[$cfg['arch']['user_options_bits']['id']]);\n            $bit[$cfg['arch']['user_options_bits']['id_user_option']] = $nid;\n            $this->db->insert($cfg['tables']['user_options_bits'], $bit);\n            $bids[$old_id] = $this->db->last_id();\n          }\n        }\n        $remaining = -1;\n        $before = 0;\n        $done = [];\n        while ($remaining && ($before !== $remaining)) {\n          if ($remaining === -1) {\n            $before = 0;\n          }\n          else {\n            $before = $remaining;\n          }\n          $remaining = 0;\n          foreach ($ids as $oid => $nid) {\n            if (in_array($nid, $done)) {\n              continue;\n            }\n            $bits = $this->db->rselect_all($cfg['tables']['user_options_bits'], [], [\n              $cfg['arch']['user_options_bits']['id_user_option'] => $oid,\n              [$cfg['arch']['user_options_bits']['id_parent'], 'isnotnull']\n            ]);\n            if (!count($bits)) {\n              $done[] = $nid;\n              continue;\n            }\n            foreach ($bits as $bit) {\n              $old_id = $bit[$cfg['arch']['user_options_bits']['id']];\n              if (isset($bids[$old_id])) {\n                continue;\n              }\n              if (!isset($bids[$bit[$cfg['arch']['user_options_bits']['id_parent']]])) {\n                $remaining++;\n              }\n              else {\n                unset($bit[$cfg['arch']['user_options_bits']['id']]);\n                $bit[$cfg['arch']['user_options_bits']['id_user_option']] = $nid;\n                $bit[$cfg['arch']['user_options_bits']['id_parent']] = $bids[$bit[$cfg['arch']['user_options_bits']['id_parent']]];\n                $this->db->insert($cfg['tables']['user_options_bits'], $bit);\n                $bids[$old_id] = $this->db->last_id();\n              }\n            }\n          }\n        }\n      }\n      return $id_new;\n    }\n    return null;\n  }",
            "startLine": 448,
            "endLine": 540,
            "isDeprecated": false,
            "isGenerator": false,
            "isInternal": false,
            "isUserDefined": true,
            "isVariadic": false,
            "returnsReference": false,
            "numberOfParameters": 3,
            "numberOfRequiredParameters": 3,
            "returns": [
                "string",
                null
            ],
            "parent": false,
            "arguments": [
                {
                    "name": "type",
                    "position": 0,
                    "type": "string",
                    "required": true,
                    "has_default": false,
                    "default": "",
                    "default_name": ""
                },
                {
                    "name": "id",
                    "position": 1,
                    "type": "string",
                    "required": true,
                    "has_default": false,
                    "default": "",
                    "default_name": ""
                },
                {
                    "name": "data",
                    "position": 2,
                    "type": "array",
                    "required": true,
                    "has_default": false,
                    "default": "",
                    "default_name": ""
                }
            ]
        },
        "send_mail": {
            "name": "send_mail",
            "summary": "",
            "description": "",
            "description_parts": [],
            "file": "bbn\\user\\manager",
            "static": false,
            "visibility": "public",
            "final": false,
            "code": "function($id_user, $subject, $text, array $attachments = [])\n  {\n    if ( !$this->get_mailer() ){\n      throw new \\Exception(_(\"Impossible to make hotlinks without a proper mailer parameter\"));\n    }\n    if ( ($usr = $this->get_user($id_user)) && $usr['email']){\n      return $this->mailer->send([\n        'to' => $usr['email'],\n        'subject' => $subject,\n        'text' => $text,\n        'attachments' => $attachments\n      ]);\n    }\n    return null;\n  }",
            "startLine": 543,
            "endLine": 557,
            "isDeprecated": false,
            "isGenerator": false,
            "isInternal": false,
            "isUserDefined": true,
            "isVariadic": false,
            "returnsReference": false,
            "numberOfParameters": 4,
            "numberOfRequiredParameters": 3,
            "returns": [
                "int",
                null
            ],
            "parent": false,
            "arguments": [
                {
                    "name": "id_user",
                    "position": 0,
                    "type": "string",
                    "required": true,
                    "has_default": false,
                    "default": "",
                    "default_name": ""
                },
                {
                    "name": "subject",
                    "position": 1,
                    "type": "string",
                    "required": true,
                    "has_default": false,
                    "default": "",
                    "default_name": ""
                },
                {
                    "name": "text",
                    "position": 2,
                    "type": "string",
                    "required": true,
                    "has_default": false,
                    "default": "",
                    "default_name": ""
                },
                {
                    "name": "attachments",
                    "position": 3,
                    "type": "array",
                    "required": false,
                    "has_default": true,
                    "default": [],
                    "default_name": ""
                }
            ]
        },
        "make_hotlink": {
            "name": "make_hotlink",
            "summary": "",
            "description": "",
            "description_parts": [],
            "file": "bbn\\user\\manager",
            "static": false,
            "visibility": "public",
            "final": false,
            "code": "function($id_user, $message = 'hotlink', $exp = NULL)\n  {\n    if (!isset($this->messages[$message]) || empty($this->messages[$message]['link'])) {\n      switch ($message)\n      {\n        case 'hotlink':\n          if ($path = bbn\\mvc::get_plugin_url('appui-usergroup')) {\n            $this->messages[$message]['link'] = BBN_URL.$path.'\/main\/profile';\n          }\n          break;\n        case 'creation':\n          if ($path = bbn\\mvc::get_plugin_url('appui-core')) {\n            $this->messages[$message]['link'] = BBN_URL.$path.'\/login\/password\/%s';\n          }\n          break;\n        case 'password':\n          if ($path = bbn\\mvc::get_plugin_url('appui-core')) {\n            $this->messages[$message]['link'] = BBN_URL.$path.'\/login\/password\/%s';\n          }\n          break;\n      }\n      if (empty($this->messages[$message]['link'])) {\n        die(\"Impossible to make hotlinks without a link configured\");\n      }\n    }\n\n    if ($usr = $this->get_user($id_user)) {\n      \/\/ Expiration date\n      if ( !\\is_int($exp) || ($exp < 1) ){\n        $exp = time() + $this->hotlink_length;\n      }\n      $hl =& $this->class_cfg['arch']['hotlinks'];\n      \/\/ Expire existing valid hotlinks\n      $this->db->update($this->class_cfg['tables']['hotlinks'], [\n        $hl['expire'] => date('Y-m-d H:i:s')\n      ],[\n        [$hl['id_user'], '=', $id_user],\n        [$hl['expire'], '>', date('Y-m-d H:i:s')]\n      ]);\n      $magic = $this->usrcls->make_magic_string();\n      \/\/ Create hotlink\n      $this->db->insert($this->class_cfg['tables']['hotlinks'], [\n        $hl['magic'] => $magic['hash'],\n        $hl['id_user'] => $id_user,\n        $hl['expire'] => date('Y-m-d H:i:s', $exp)\n      ]);\n      $id_link = $this->db->last_id();\n      $link = \"?id=$id_link&key=\".$magic['key'];\n      $this->send_mail(\n        $id_user,\n        $this->messages[$message]['subject'],\n        sprintf($this->messages[$message]['text'], sprintf($this->messages[$message]['link'], $link))\n      );\n    }\n    else{\n      x::log(\"User $id_user not found\");\n      throw new \\Exception(_('User not found'));\n    }\n    return $this;\n  }",
            "startLine": 567,
            "endLine": 626,
            "isDeprecated": false,
            "isGenerator": false,
            "isInternal": false,
            "isUserDefined": true,
            "isVariadic": false,
            "returnsReference": false,
            "numberOfParameters": 3,
            "numberOfRequiredParameters": 1,
            "returns": [
                "self"
            ],
            "parent": false,
            "arguments": [
                {
                    "name": "id_user",
                    "position": 0,
                    "type": "string",
                    "required": true,
                    "has_default": false,
                    "default": "",
                    "default_name": "",
                    "description": "Type of the message"
                },
                {
                    "name": "message",
                    "position": 1,
                    "type": "string",
                    "required": false,
                    "has_default": true,
                    "default": "hotlink",
                    "default_name": "",
                    "description": "Timestamp of the expiration date"
                },
                {
                    "name": "exp",
                    "position": 2,
                    "type": null,
                    "required": false,
                    "has_default": true,
                    "default": null,
                    "default_name": ""
                }
            ]
        },
        "set_unique_group": {
            "name": "set_unique_group",
            "summary": "",
            "description": "",
            "description_parts": [],
            "file": "bbn\\user\\manager",
            "static": false,
            "visibility": "public",
            "final": false,
            "code": "function($id_user, $id_group)\n  {\n    return (bool)$this->db->update($this->class_cfg['tables']['users'], [\n      $this->class_cfg['arch']['users']['id_group'] => $id_group\n    ], [\n      $this->class_cfg['arch']['users']['id'] => $id_user\n    ]);\n  }",
            "startLine": 635,
            "endLine": 642,
            "isDeprecated": false,
            "isGenerator": false,
            "isInternal": false,
            "isUserDefined": true,
            "isVariadic": false,
            "returnsReference": false,
            "numberOfParameters": 2,
            "numberOfRequiredParameters": 2,
            "returns": [
                "bool"
            ],
            "parent": false,
            "arguments": [
                {
                    "name": "id_user",
                    "position": 0,
                    "type": "string",
                    "required": true,
                    "has_default": false,
                    "default": "",
                    "default_name": "",
                    "description": "user User ID"
                },
                {
                    "name": "id_group",
                    "position": 1,
                    "type": "string",
                    "required": true,
                    "has_default": false,
                    "default": "",
                    "default_name": "",
                    "description": "group Group ID"
                }
            ]
        },
        "user_has_option": {
            "name": "user_has_option",
            "summary": "",
            "description": "",
            "description_parts": [],
            "file": "bbn\\user\\manager",
            "static": false,
            "visibility": "public",
            "final": false,
            "code": "function($id_user, $id_option, $with_group = true)\n  {\n    if ( $with_group && $user = $this->get_user($id_user) ){\n      $id_group = $user[$this->class_cfg['arch']['users']['id_group']];\n      if ( $this->group_has_option($id_group, $id_option) ){\n        return true;\n      }\n    }\n    if ( $pref = preferences::get_preferences() ){\n      if ( $cfg = $pref->get_class_cfg() ){\n        return $this->db->count($cfg['table'], [\n          $cfg['arch']['user_options']['id_option'] => $id_option,\n          $cfg['arch']['user_options']['id_user'] => $id_user\n        ]) ? true : false;\n      }\n    }\n    return false;\n  }",
            "startLine": 644,
            "endLine": 661,
            "isDeprecated": false,
            "isGenerator": false,
            "isInternal": false,
            "isUserDefined": true,
            "isVariadic": false,
            "returnsReference": false,
            "numberOfParameters": 3,
            "numberOfRequiredParameters": 2,
            "returns": [
                "bool"
            ],
            "parent": false,
            "arguments": [
                {
                    "name": "id_user",
                    "position": 0,
                    "type": "string",
                    "required": true,
                    "has_default": false,
                    "default": "",
                    "default_name": ""
                },
                {
                    "name": "id_option",
                    "position": 1,
                    "type": "string",
                    "required": true,
                    "has_default": false,
                    "default": "",
                    "default_name": ""
                },
                {
                    "name": "with_group",
                    "position": 2,
                    "type": "bool",
                    "required": false,
                    "has_default": true,
                    "default": true,
                    "default_name": ""
                }
            ]
        },
        "group_has_option": {
            "name": "group_has_option",
            "summary": "",
            "description": "",
            "description_parts": [],
            "file": "bbn\\user\\manager",
            "static": false,
            "visibility": "public",
            "final": false,
            "code": "function($id_group, $id_option)\n  {\n    if (\n      ($pref = preferences::get_preferences()) &&\n      ($cfg = $pref->get_class_cfg())\n    ){\n      return $this->db->count($cfg['table'], [\n        $cfg['arch']['user_options']['id_option'] => $id_option,\n        $cfg['arch']['user_options']['id_group'] => $id_group\n      ]) ? true : false;\n    }\n    return false;\n  }",
            "startLine": 663,
            "endLine": 675,
            "isDeprecated": false,
            "isGenerator": false,
            "isInternal": false,
            "isUserDefined": true,
            "isVariadic": false,
            "returnsReference": false,
            "numberOfParameters": 2,
            "numberOfRequiredParameters": 2,
            "returns": [
                "bool"
            ],
            "parent": false,
            "arguments": [
                {
                    "name": "id_group",
                    "position": 0,
                    "type": "string",
                    "required": true,
                    "has_default": false,
                    "default": "",
                    "default_name": ""
                },
                {
                    "name": "id_option",
                    "position": 1,
                    "type": "string",
                    "required": true,
                    "has_default": false,
                    "default": "",
                    "default_name": ""
                }
            ]
        },
        "get_options": {
            "name": "get_options",
            "summary": "",
            "description": "",
            "description_parts": [],
            "file": "bbn\\user\\manager",
            "static": false,
            "visibility": "public",
            "final": false,
            "code": "function($type, $id)\n  {\n    if (\n      ($pref = preferences::get_preferences()) &&\n      ($cfg = $pref->get_class_cfg())\n    ){\n      if (stripos($type,  'group') === 0) {\n        return $this->db->rselect_all($cfg['table'], [], [\n          $cfg['arch']['user_options']['id_group'] => $id\n        ]);\n      }\n      elseif (stripos($type, 'user') === 0) {\n        return $this->db->rselect_all($cfg['table'], [], [\n          $cfg['arch']['user_options']['id_user'] => $id\n        ]);\n      }\n    }\n    return null;\n  }",
            "startLine": 677,
            "endLine": 695,
            "isDeprecated": false,
            "isGenerator": false,
            "isInternal": false,
            "isUserDefined": true,
            "isVariadic": false,
            "returnsReference": false,
            "numberOfParameters": 2,
            "numberOfRequiredParameters": 2,
            "returns": [
                "array",
                null
            ],
            "parent": false,
            "arguments": [
                {
                    "name": "type",
                    "position": 0,
                    "type": "string",
                    "required": true,
                    "has_default": false,
                    "default": "",
                    "default_name": ""
                },
                {
                    "name": "id",
                    "position": 1,
                    "type": "string",
                    "required": true,
                    "has_default": false,
                    "default": "",
                    "default_name": ""
                }
            ]
        },
        "user_insert_option": {
            "name": "user_insert_option",
            "summary": "",
            "description": "",
            "description_parts": [],
            "file": "bbn\\user\\manager",
            "static": false,
            "visibility": "public",
            "final": false,
            "code": "function($id_user, $id_option)\n  {\n    if (\n      ($pref = preferences::get_preferences()) &&\n      ($cfg = $pref->get_class_cfg())\n    ){\n      return (bool)$this->db->insert_ignore($cfg['table'], [\n        $cfg['arch']['user_options']['id_option'] => $id_option,\n        $cfg['arch']['user_options']['id_user'] => $id_user\n      ]);\n    }\n    return false;\n  }",
            "startLine": 697,
            "endLine": 709,
            "isDeprecated": false,
            "isGenerator": false,
            "isInternal": false,
            "isUserDefined": true,
            "isVariadic": false,
            "returnsReference": false,
            "numberOfParameters": 2,
            "numberOfRequiredParameters": 2,
            "returns": [
                "bool"
            ],
            "parent": false,
            "arguments": [
                {
                    "name": "id_user",
                    "position": 0,
                    "type": "string",
                    "required": true,
                    "has_default": false,
                    "default": "",
                    "default_name": ""
                },
                {
                    "name": "id_option",
                    "position": 1,
                    "type": "string",
                    "required": true,
                    "has_default": false,
                    "default": "",
                    "default_name": ""
                }
            ]
        },
        "group_insert_option": {
            "name": "group_insert_option",
            "summary": "",
            "description": "",
            "description_parts": [],
            "file": "bbn\\user\\manager",
            "static": false,
            "visibility": "public",
            "final": false,
            "code": "function($id_group, $id_option)\n  {\n    if (\n      ($pref = preferences::get_preferences()) &&\n      ($cfg = $pref->get_class_cfg())\n    ){\n      return (bool)$this->db->insert_ignore($cfg['table'], [\n        $cfg['arch']['user_options']['id_option'] => $id_option,\n        $cfg['arch']['user_options']['id_group'] => $id_group\n      ]);\n    }\n    return false;\n  }",
            "startLine": 711,
            "endLine": 723,
            "isDeprecated": false,
            "isGenerator": false,
            "isInternal": false,
            "isUserDefined": true,
            "isVariadic": false,
            "returnsReference": false,
            "numberOfParameters": 2,
            "numberOfRequiredParameters": 2,
            "returns": [
                "bool"
            ],
            "parent": false,
            "arguments": [
                {
                    "name": "id_group",
                    "position": 0,
                    "type": "string",
                    "required": true,
                    "has_default": false,
                    "default": "",
                    "default_name": ""
                },
                {
                    "name": "id_option",
                    "position": 1,
                    "type": "string",
                    "required": true,
                    "has_default": false,
                    "default": "",
                    "default_name": ""
                }
            ]
        },
        "user_delete_option": {
            "name": "user_delete_option",
            "summary": "",
            "description": "",
            "description_parts": [],
            "file": "bbn\\user\\manager",
            "static": false,
            "visibility": "public",
            "final": false,
            "code": "function($id_user, $id_option)\n  {\n    if (\n      ($pref = preferences::get_preferences()) &&\n      ($cfg = $pref->get_class_cfg())\n    ){\n      return (bool)$this->db->delete_ignore($cfg['table'], [\n        $cfg['arch']['user_options']['id_option'] => $id_option,\n        $cfg['arch']['user_options']['id_user'] => $id_user\n      ]);\n    }\n    return false;\n  }",
            "startLine": 725,
            "endLine": 737,
            "isDeprecated": false,
            "isGenerator": false,
            "isInternal": false,
            "isUserDefined": true,
            "isVariadic": false,
            "returnsReference": false,
            "numberOfParameters": 2,
            "numberOfRequiredParameters": 2,
            "returns": [
                "bool"
            ],
            "parent": false,
            "arguments": [
                {
                    "name": "id_user",
                    "position": 0,
                    "type": "string",
                    "required": true,
                    "has_default": false,
                    "default": "",
                    "default_name": ""
                },
                {
                    "name": "id_option",
                    "position": 1,
                    "type": "string",
                    "required": true,
                    "has_default": false,
                    "default": "",
                    "default_name": ""
                }
            ]
        },
        "group_delete_option": {
            "name": "group_delete_option",
            "summary": "",
            "description": "",
            "description_parts": [],
            "file": "bbn\\user\\manager",
            "static": false,
            "visibility": "public",
            "final": false,
            "code": "function($id_group, $id_option)\n  {\n    if (\n      ($pref = preferences::get_preferences()) &&\n      ($cfg = $pref->get_class_cfg())\n    ){\n      return (bool)$this->db->delete_ignore($cfg['table'], [\n        $cfg['arch']['user_options']['id_option'] => $id_option,\n        $cfg['arch']['user_options']['id_group'] => $id_group\n      ]);\n    }\n    return false;\n  }",
            "startLine": 739,
            "endLine": 751,
            "isDeprecated": false,
            "isGenerator": false,
            "isInternal": false,
            "isUserDefined": true,
            "isVariadic": false,
            "returnsReference": false,
            "numberOfParameters": 2,
            "numberOfRequiredParameters": 2,
            "returns": [
                "bool"
            ],
            "parent": false,
            "arguments": [
                {
                    "name": "id_group",
                    "position": 0,
                    "type": "string",
                    "required": true,
                    "has_default": false,
                    "default": "",
                    "default_name": ""
                },
                {
                    "name": "id_option",
                    "position": 1,
                    "type": "string",
                    "required": true,
                    "has_default": false,
                    "default": "",
                    "default_name": ""
                }
            ]
        },
        "group_num_users": {
            "name": "group_num_users",
            "summary": "",
            "description": "",
            "description_parts": [],
            "file": "bbn\\user\\manager",
            "static": false,
            "visibility": "public",
            "final": false,
            "code": "function($id_group)\n  {\n    $u =& $this->class_cfg['arch']['users'];\n    return $this->db->count($this->class_cfg['tables']['users'], [\n      $u['id_group'] => $id_group\n    ]);\n  }",
            "startLine": 753,
            "endLine": 759,
            "isDeprecated": false,
            "isGenerator": false,
            "isInternal": false,
            "isUserDefined": true,
            "isVariadic": false,
            "returnsReference": false,
            "numberOfParameters": 1,
            "numberOfRequiredParameters": 1,
            "returns": [
                "int"
            ],
            "parent": false,
            "arguments": [
                {
                    "name": "id_group",
                    "position": 0,
                    "type": "string",
                    "required": true,
                    "has_default": false,
                    "default": "",
                    "default_name": ""
                }
            ]
        },
        "group_insert": {
            "name": "group_insert",
            "summary": "",
            "description": "",
            "description_parts": [],
            "file": "bbn\\user\\manager",
            "static": false,
            "visibility": "public",
            "final": false,
            "code": "function(array $data)\n  {\n    $g = $this->class_cfg['arch']['groups'];\n    if ( isset($data[$g['group']]) ){\n      if (!empty($data[$g['cfg']]) && is_array($data[$g['cfg']])) {\n        $data[$g['cfg']] = json_encode($data[$g['cfg']]);\n      }\n      if ( $this->db->insert($this->class_cfg['tables']['groups'], [\n        $g['group'] => $data[$g['group']],\n        $g['cfg'] => !empty($g['cfg']) && !empty($data[$g['cfg']]) ? $data[$g['cfg']] : '{}'\n      ]) ){\n        return $this->db->last_id();\n      }\n    }\n    return null;\n  }",
            "startLine": 761,
            "endLine": 776,
            "isDeprecated": false,
            "isGenerator": false,
            "isInternal": false,
            "isUserDefined": true,
            "isVariadic": false,
            "returnsReference": false,
            "numberOfParameters": 1,
            "numberOfRequiredParameters": 1,
            "returns": [
                "string",
                null
            ],
            "parent": false,
            "arguments": [
                {
                    "name": "data",
                    "position": 0,
                    "type": "array",
                    "required": true,
                    "has_default": false,
                    "default": "",
                    "default_name": ""
                }
            ]
        },
        "group_rename": {
            "name": "group_rename",
            "summary": "",
            "description": "",
            "description_parts": [],
            "file": "bbn\\user\\manager",
            "static": false,
            "visibility": "public",
            "final": false,
            "code": "function($id, $name)\n  {\n    $g = $this->class_cfg['arch']['groups'];\n    return (bool)$this->db->update($this->class_cfg['tables']['groups'], [\n      $g['group'] => $name\n    ], [\n      $g['id'] => $id\n    ]);\n  }",
            "startLine": 778,
            "endLine": 786,
            "isDeprecated": false,
            "isGenerator": false,
            "isInternal": false,
            "isUserDefined": true,
            "isVariadic": false,
            "returnsReference": false,
            "numberOfParameters": 2,
            "numberOfRequiredParameters": 2,
            "returns": [
                "bool"
            ],
            "parent": false,
            "arguments": [
                {
                    "name": "id",
                    "position": 0,
                    "type": "string",
                    "required": true,
                    "has_default": false,
                    "default": "",
                    "default_name": ""
                },
                {
                    "name": "name",
                    "position": 1,
                    "type": "string",
                    "required": true,
                    "has_default": false,
                    "default": "",
                    "default_name": ""
                }
            ]
        },
        "group_set_cfg": {
            "name": "group_set_cfg",
            "summary": "",
            "description": "",
            "description_parts": [],
            "file": "bbn\\user\\manager",
            "static": false,
            "visibility": "public",
            "final": false,
            "code": "function($id, array $cfg)\n  {\n    $g = $this->class_cfg['arch']['groups'];\n    return (bool)$this->db->update($this->class_cfg['tables']['groups'], [\n      $g['cfg'] => $cfg ?: '{}'\n    ], [\n      $g['id'] => $id\n    ]);\n  }",
            "startLine": 788,
            "endLine": 796,
            "isDeprecated": false,
            "isGenerator": false,
            "isInternal": false,
            "isUserDefined": true,
            "isVariadic": false,
            "returnsReference": false,
            "numberOfParameters": 2,
            "numberOfRequiredParameters": 2,
            "returns": [
                "bool"
            ],
            "parent": false,
            "arguments": [
                {
                    "name": "id",
                    "position": 0,
                    "type": "string",
                    "required": true,
                    "has_default": false,
                    "default": "",
                    "default_name": ""
                },
                {
                    "name": "cfg",
                    "position": 1,
                    "type": "array",
                    "required": true,
                    "has_default": false,
                    "default": "",
                    "default_name": ""
                }
            ]
        },
        "group_delete": {
            "name": "group_delete",
            "summary": "",
            "description": "",
            "description_parts": [],
            "file": "bbn\\user\\manager",
            "static": false,
            "visibility": "public",
            "final": false,
            "code": "function($id)\n  {\n    $g = $this->class_cfg['arch']['groups'];\n    if ( $this->group_num_users($id) ){\n      \/** @todo Error management *\/\n      throw new \\Exception(_(\"Impossible to delete this group as it has users\"));\n    }\n    return (bool)$this->db->delete($this->class_cfg['tables']['groups'], [\n      $g['id'] => $id\n    ]);\n  }",
            "startLine": 798,
            "endLine": 808,
            "isDeprecated": false,
            "isGenerator": false,
            "isInternal": false,
            "isUserDefined": true,
            "isVariadic": false,
            "returnsReference": false,
            "numberOfParameters": 1,
            "numberOfRequiredParameters": 1,
            "returns": [
                "bool"
            ],
            "parent": false,
            "arguments": [
                {
                    "name": "id",
                    "position": 0,
                    "type": "string",
                    "required": true,
                    "has_default": false,
                    "default": "",
                    "default_name": ""
                }
            ]
        },
        "deactivate": {
            "name": "deactivate",
            "summary": "",
            "description": "",
            "description_parts": [],
            "file": "bbn\\user\\manager",
            "static": false,
            "visibility": "public",
            "final": false,
            "code": "function($id_user)\n  {\n    $update = [\n      $this->class_cfg['arch']['users']['active'] => 0,\n      $this->class_cfg['arch']['users']['email'] => null,\n    ];\n    if ( !empty($this->class_cfg['arch']['users']['login']) ){\n      $update[$this->class_cfg['arch']['users']['login']] = null;\n    }\n\n    if ($this->db->update($this->class_cfg['tables']['users'], $update, [\n      $this->class_cfg['arch']['users']['id'] => $id_user\n    ])) {\n      \/\/ Deleting existing sessions\n      $this->db->delete($this->class_cfg['tables']['sessions'], [$this->class_cfg['arch']['sessions']['id_user'] => $id_user]);\n      return true;\n    }\n    return false;\n  }",
            "startLine": 815,
            "endLine": 833,
            "isDeprecated": false,
            "isGenerator": false,
            "isInternal": false,
            "isUserDefined": true,
            "isVariadic": false,
            "returnsReference": false,
            "numberOfParameters": 1,
            "numberOfRequiredParameters": 1,
            "returns": [
                "bool"
            ],
            "parent": false,
            "arguments": [
                {
                    "name": "id_user",
                    "position": 0,
                    "type": "string",
                    "required": true,
                    "has_default": false,
                    "default": "",
                    "default_name": "",
                    "description": "user User ID"
                }
            ]
        },
        "reactivate": {
            "name": "reactivate",
            "summary": "",
            "description": "",
            "description_parts": [],
            "file": "bbn\\user\\manager",
            "static": false,
            "visibility": "public",
            "final": false,
            "code": "function($id_user)\n  {\n    return (bool)$this->db->update($this->class_cfg['tables']['users'], [\n      $this->class_cfg['arch']['users']['active'] => 1\n    ], [\n      $this->class_cfg['arch']['users']['id'] => $id_user\n    ]);\n  }",
            "startLine": 840,
            "endLine": 847,
            "isDeprecated": false,
            "isGenerator": false,
            "isInternal": false,
            "isUserDefined": true,
            "isVariadic": false,
            "returnsReference": false,
            "numberOfParameters": 1,
            "numberOfRequiredParameters": 1,
            "returns": [
                "bool"
            ],
            "parent": false,
            "arguments": [
                {
                    "name": "id_user",
                    "position": 0,
                    "type": "string",
                    "required": true,
                    "has_default": false,
                    "default": "",
                    "default_name": "",
                    "description": "user User ID"
                }
            ]
        }
    },
    "properties": null,
    "staticProperties": {
        "admin_group": null,
        "dev_group": null
    },
    "constants": null,
    "numMethods": 39,
    "numProperties": 0,
    "numConstants": 0,
    "numStaticProperties": 2,
    "interfaceNames": [],
    "isInterface": false,
    "traitNames": [],
    "traitAliases": [],
    "isTrait": false,
    "isAbstract": false,
    "isFinal": false,
    "modifiers": 0,
    "parentClass": null,
    "isSubclassOf": false,
    "defaultProperties": {
        "admin_group": null,
        "dev_group": null,
        "messages": {
            "creation": {
                "subject": "Account created",
                "link": "",
                "text": "\nA new user has been created for you.<br>\nPlease click the link below in order to activate your account:<br>\n%1$s"
            },
            "password": {
                "subject": "Password change",
                "link": "",
                "text": "\nYou can click the following link to change your password:<br>\n%1$s"
            },
            "hotlink": {
                "subject": "Hotlink",
                "link": "",
                "text": "\nYou can click the following link to access directly your account:<br>\n%1$s"
            }
        },
        "hotlink_length": 86400,
        "list_fields": null,
        "usrcls": null,
        "mailer": false,
        "db": null,
        "class_cfg": false
    },
    "isIterable": false,
    "extensionName": false,
    "namespaceName": "bbn\\user",
    "shortName": "manager",
    "summary": "A class for managing users"
}